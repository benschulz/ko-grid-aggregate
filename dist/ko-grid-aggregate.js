/*
 Copyright (c) 2015, Ben Schulz
 License: BSD 3-clause (http://opensource.org/licenses/BSD-3-Clause)
*/
function p(l,m){return function(c){return c}(function(c,h,g){function l(b,k){return b.data.source.streamValues(function(a){return a.filteredBy(b.data.predicate)}).then(function(a){var f={count:0};k.forEach(function(b){f[b]={minimum:Number.POSITIVE_INFINITY,maximum:Number.NEGATIVE_INFINITY,sum:0}});return a.reduce(function(a,c){++f.count;k.forEach(function(a){var d=f[a];a=b.data.valueSelector(c[a]);d.minimum=Math.min(d.minimum,a);d.maximum=Math.max(d.maximum,a);d.sum+=a});return a},f)})}c="ko-grid-aggregate".substr(0,
-1).substr(0,-1);g.defineExtension(c,{t:function(b){b.to("tfoot").prepend("aggregates",'<tr class="ko-grid-tr ko-grid-aggregate-row" data-bind="indexedRepeat: {  forEach: extensions.aggregate.__aggregateRows,  indexedBy: \'id\',  as: \'aggregateRow\'}">  <td class="ko-grid-tf ko-grid-aggregate"    data-bind="indexedRepeat: {      forEach: columns.displayed,      indexedBy: \'id\',      as: \'column\'    }"    data-repeat-bind="      __gridAggregate: aggregateRow()[column().id],      _gridWidth: column().width()"></td></tr>')},
r:function(b,c,a){var f=h.observable([]);this.__aggregateRows=f;if(Array.isArray(b)){var n=[];b.forEach(function(b){Object.keys(b).forEach(function(b){b=a.columns.byId(b).property;0>n.indexOf(b)&&n.push(b)})});var g=c.statisticsComputer||l,m=0,d=h.computed(function(){a.data.predicate();a.data.view.values();return g(a,n).then(function(c){var d=c.count;f(b.map(function(b){var f={id:""+ ++m};a.columns.displayed().forEach(function(a){var h=a.id,e=a.property,g=b[h];if(g){if(d)if(e="average"===g?c[e].sum/
d:c[e][g],1<=Math.abs(e))e=e.toLocaleString();else var k=-Math.floor(Math.log(e)/Math.log(10)),e=e.toLocaleString(void 0,{maximumFractionDigits:k+1});else e="N/A";a={column:a,i:g,value:e}}else a={column:a};f[h]=a});return f}));a.layout.recalculate()})});this.dispose=function(){d.dispose()}}}});h.bindingHandlers.__gridAggregate={init:function(b){for(;b.firstChild;)h.removeNode(b.firstChild);b.appendChild(window.document.createTextNode(""));return{controlsDescendantBindings:!0}},update:function(b,c){var a=
c();b.className=["ko-grid-tf ko-grid-aggregate"+(a.i?" "+a.i:"")].concat(a.column.footerClasses()).join(" ");b.firstChild.nodeValue=a.i?a.value:""}};return g.declareExtensionAlias("aggregate",c)}({},m,l))}"function"===typeof define&&define.amd?define(["ko-grid","knockout","ko-data-source","ko-indexed-repeat"],p):window["ko-grid-aggregate"]=p(window.ko.bindingHandlers.grid,window.ko);