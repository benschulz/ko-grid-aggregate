/*
 Copyright (c) 2015, Ben Schulz
 License: BSD 3-clause (http://opensource.org/licenses/BSD-3-Clause)
*/
function n(h,l){return function(c){return c}(function(c,m,e){c="ko-grid-aggregate".substr(0,-1).substr(0,-1);e.defineExtension(c,{c:function(a){a.to("tfoot").prepend("aggregates",'<tr class="ko-grid-tr ko-grid-aggregate-row" data-bind="indexedRepeat: {  forEach: extensions.aggregate.__aggregateRows,  indexedBy: \'id\',  as: \'aggregateRow\'}">  <td class="ko-grid-tf ko-grid-aggregate"    data-bind="indexedRepeat: {      forEach: columns.displayed,      indexedBy: \'id\',      as: \'column\'    }"    data-repeat-bind="      __gridAggregate: aggregateRow()[column().id],      _gridWidth: column().width()"></td></tr>')},
b:function(a,c,b){var e=m.observable([]);this.__aggregateRows=e;if(Array.isArray(a)){var g=[];a.forEach(function(a){Object.keys(a).forEach(function(a){a=b.columns.byId(a).property;0>g.indexOf(a)&&g.push(a)})});var h=0;c=function(){b.data.source.streamValues(function(a){return a.filteredBy(b.data.predicate)}).then(function(a){var c={count:0};g.forEach(function(a){c[a]={minimum:Number.POSITIVE_INFINITY,maximum:Number.NEGATIVE_INFINITY,sum:0}});return a.reduce(function(a,e){++c.count;g.forEach(function(a){var f=
c[a];a=b.data.valueSelector(e[a]);f.minimum=Math.min(f.minimum,a);f.maximum=Math.max(f.maximum,a);f.sum+=a});return a},c)}).then(function(c){var g=c.count;e(a.map(function(a){var e={id:""+ ++h};b.columns.displayed().forEach(function(b){var f=b.id,d=b.property,k=a[f];if(k){if(g)if(d="average"===k?c[d].sum/g:c[d][k],1<=Math.abs(d))d=d.toLocaleString();else var h=-Math.floor(Math.log(d)/Math.log(10)),d=d.toLocaleString(void 0,{maximumFractionDigits:h+1});else d="N/A";b={column:b,a:k,value:d}}else b=
{column:b};e[f]=b});return e}));b.layout.recalculate()})};var l=b.data.predicate.subscribe(c);c();this.dispose=function(){l.dispose()}}}});m.bindingHandlers.__gridAggregate={init:function(a){for(;a.firstChild;)m.removeNode(a.firstChild);a.appendChild(window.document.createTextNode(""));return{controlsDescendantBindings:!0}},update:function(a,c){var b=c();a.className=["ko-grid-tf ko-grid-aggregate"+(b.a?" "+b.a:"")].concat(b.column.footerClasses()).join(" ");a.firstChild.nodeValue=b.a?b.value:""}};
return e.declareExtensionAlias("aggregate",c)}({},l,h))}"function"===typeof define&&define.amd?define(["ko-grid","knockout","ko-data-source","ko-indexed-repeat"],n):window["ko-grid-aggregate"]=n(window.ko.bindingHandlers.grid,window.ko);
